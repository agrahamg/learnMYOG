---
import Layout from "@/layouts/Layout.astro";
import "leaflet/dist/leaflet.css";

const flags = {
  US: "ğŸ‡ºğŸ‡¸",
  AU: "ğŸ‡¦ğŸ‡º",
  CA: "ğŸ‡¨ğŸ‡¦",
  DE: "ğŸ‡©ğŸ‡ª",
  FI: "ğŸ‡«ğŸ‡®",
  GB: "ğŸ‡¬ğŸ‡§",
  PL: "ğŸ‡µğŸ‡±",
  SE: "ğŸ‡¸ğŸ‡ª",
  SI: "ğŸ‡¸ğŸ‡®",
} as Record<string, string>;

import markers from "@/assets/db/vendormap.json";
markers.sort(
  (a, b) => a.country.localeCompare(b.country) || a.name.localeCompare(b.name)
);
---

<Layout
  title="LearnMYOG Map"
  description="Learn to Make Your Own Gear (MYOG) suppliers aroudn the globe. Your best resources for fabric and hardware to make DIY outdoor backpacks and apparel."
>
  <main class="container py-10">
    <h1 style="display:none">MYOG Suppliers</h1>

    <div id="map" style="height:400px"></div>

    <p class="py-5 text-center text-xl">â­ï¸ LearnMYOG Recommended All-Stars</p>

    <ul class="columns-1 pl-10 leading-loose md:columns-3">
      {
        markers.map((marker) => (
          <li class="no-deco">
            {flags[marker.country] ?? "ğŸ´â€â˜ ï¸"} {marker.name}
            {marker.friend ? "â­ï¸" : null}
          </li>
        ))
      }
    </ul>
  </main>
</Layout>

<script>
  import L from "leaflet";
  import type { PointExpression } from "leaflet";
  import markers from "@/assets/db/vendormap.json";

  const options = {
    iconSize: [25, 41] as PointExpression,
    iconAnchor: [10, 41] as PointExpression,
    popupAnchor: [2, -40] as PointExpression,
  };

  const map = L.map("map", { worldCopyJump: true, center: [40, -53], zoom: 3 });

  L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 9,
    attribution:
      '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
  }).addTo(map);

  let yellowIcon = L.icon({
    iconUrl: "assets/images/marker-icon-2x-gold.png",
    ...options,
  });
  let blueIcon = L.icon({
    iconUrl: "assets/images/marker-icon-2x-blue.png",
    ...options,
  });

  markers.forEach((marker) => {
    L.marker([marker.lat, marker.long], {
      icon: marker.friend ? yellowIcon : blueIcon,
    })
      .addTo(map)
      .bindPopup(
        `<a href="${marker.website}" target="_blank">${
          marker.friend ? "â­ï¸" : ""
        } ${marker.name}</a>`
      );
  });
</script>
